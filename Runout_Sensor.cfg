[filament_motion_sensor filament_sensor]
detection_length: 20.00 ; This can be adjusted to your desired level of sensitivity. 10 is a recommended value to prevent flow dropoff false triggers.
#20 worked without False runout
extruder: extruder
switch_pin: ~!PG11
pause_on_runout: False ; This can be set to false to debug false positives putting the sensor in "monitor mode". The printer will not pause but it will run the runout_gcode below.
event_delay: 3.0
pause_delay: 0.5
runout_gcode:
    M117 Runout Detected!
    FILAMENT_RUNOUT_SOUND
    #PAUSE                ; Pause
insert_gcode:
  M117 Filament switch inserted
  FILAMENT_RESUME_SOUND

[delayed_gcode DISABLEFILAMENTSENSOR] ; This will disable the SFS 1 second after klipper starts
initial_duration: 1
gcode:
    SET_filament_sensor SENSOR="filament_sensor" ENABLE=0 ; Put your filament sensor's name after SENSOR=

[gcode_macro SFS_ENABLE] ; Add this to PRINT_START
description: Enable smart filament sensor
gcode:
    M117 ENABLING the Smart filament sensor
    G92 E0
    SET_filament_sensor SENSOR="filament_sensor" ENABLE=1 ; Put your filament sensor's name after SENSOR=

[gcode_macro SFS_DISABLE] ; Add this to PRINT_END and PRINT_CANCEL
description: Disable smart filament sensor
gcode:
    M117 DISABLING the Smart filament sensor
    G92 E0
    SET_filament_sensor SENSOR="filament_sensor" ENABLE=0 ; Put your filament sensor's name after SENSOR=
